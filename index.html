<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Tracker Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e7e34">
    <style>
        :root {
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-sub: #666666;
            --border: #eeeeee;
            --input-bg: #ffffff;
            --primary: #1e7e34;
            --danger: #dc3545;
            --whatsapp: #25D366;
            --shadow: rgba(0,0,0,0.05);
        }

        [data-theme="dark"] {
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sub: #aaaaaa;
            --border: #333333;
            --input-bg: #2d2d2d;
            --shadow: rgba(0,0,0,0.3);
        }

        body { font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text-main); display: flex; justify-content: center; padding: 15px; margin: 0; transition: 0.3s; }
        .container { background: var(--card-bg); padding: 1.2rem; border-radius: 16px; box-shadow: 0 10px 25px var(--shadow); width: 100%; max-width: 480px; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        select, .theme-btn { padding: 6px; border-radius: 8px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); font-size: 0.85rem; cursor: pointer; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        h2 { margin: 0; font-size: 1.4rem; }
        
        .action-btns { display: flex; gap: 8px; }
        .btn-small { background: none; border: 1px solid var(--border); padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600; color: var(--text-main); }
        .clear-btn { border-color: var(--danger); color: var(--danger); }
        .share-btn { border-color: var(--whatsapp); color: var(--whatsapp); }

        .input-wrapper { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; background: var(--bg); padding: 15px; border-radius: 12px; }
        .row-2 { display: grid; grid-template-columns: 0.8fr 1.2fr 1fr auto; gap: 8px; }

        input, select { padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 15px; outline: none; background: var(--input-bg); color: var(--text-main); width: 100%; box-sizing: border-box; }
        input:focus { border-color: var(--primary); }
        
        .add-btn { padding: 10px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .list-header { display: flex; padding: 10px; font-weight: bold; border-bottom: 2px solid var(--border); color: var(--text-sub); font-size: 0.9rem; }
        .list-header span:first-child { flex: 2; padding-left: 35px; }
        
        .item-row { display: flex; align-items: center; padding: 12px 10px; border-bottom: 1px solid var(--border); }
        
        .check-box { width: 22px; height: 22px; border: 2px solid var(--primary); border-radius: 6px; margin-right: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .check-box.checked { background: var(--primary); color: white; }
        .check-box.checked::after { content: 'âœ“'; font-weight: bold; font-size: 14px; }

        .item-main { display: flex; flex-direction: column; flex: 2; cursor: pointer; }
        .item-row.is-done .item-name { text-decoration: line-through; color: var(--text-sub); opacity: 0.6; }
        
        .item-name { font-weight: 600; font-size: 1rem; }
        .item-details { font-size: 0.8rem; color: var(--text-sub); }
        .item-subtotal { text-align: right; font-family: monospace; font-weight: bold; width: 85px; }
        
        .total-section { display: flex; justify-content: space-between; padding: 20px 10px; margin-top: 10px; border-top: 2px solid var(--text-main); font-size: 1.4rem; font-weight: 800; }
        .delete-btn { color: var(--text-sub); cursor: pointer; padding: 5px; margin-left: 10px; opacity: 0.4; }
        .delete-btn:hover { color: var(--danger); opacity: 1; }
    </style>
</head>
<body data-theme="light">

<div class="container">
    <div class="top-bar">
        <select id="langSelect" onchange="changeLanguage(this.value)">
            <option value="en">ðŸ‡¬ðŸ‡§ English</option>
            <option value="bn">ðŸ‡§ðŸ‡© à¦¬à¦¾à¦‚à¦²à¦¾</option>
        </select>
        <button class="theme-btn" onclick="toggleTheme()" id="themeToggle">ðŸŒ™</button>
    </div>

    <div class="header">
        <h2 id="lblTitle">Grocery List</h2>
        <div class="action-btns">
            <button class="btn-small share-btn" id="btnShare" onclick="shareList()">Share</button>
            <button class="btn-small clear-btn" id="btnClear" onclick="clearAll()">Clear</button>
        </div>
    </div>
    
    <div class="input-wrapper">
        <input type="text" id="itemInput" list="itemHistory" placeholder="Item Name">
        <datalist id="itemHistory"></datalist>
        <div class="row-2">
            <input type="number" id="qtyInput" value="1" min="0.1" step="0.1">
            <select id="unitInput"></select>
            <input type="number" id="priceInput" placeholder="Price">
            <button class="add-btn" id="btnAdd" onclick="addItem()">Add</button>
        </div>
    </div>

    <div class="list-container">
        <div class="list-header">
            <span id="lblHeaderItem">Item</span>
            <span id="lblHeaderSub">Subtotal</span>
        </div>
        <div id="itemList"></div>
        <div class="total-section">
            <span id="lblTotal">Total</span>
            <span id="totalAmount">â‚¹0</span>
        </div>
    </div>
</div>

<script>
    const masterItems = ["Milk", "Bread", "Eggs", "Rice", "Atta", "Dal", "Sugar", "Salt", "Tea", "Coffee", "Onion", "Potato", "Tomato", "Ginger", "Garlic", "Oil", "Ghee", "Soap", "Shampoo", "Butter", "à¦¦à§à¦§", "à¦ªà¦¾à¦‰à¦°à§à¦Ÿà¦¿", "à¦¡à¦¿à¦®", "à¦šà¦¾à¦²", "à¦†à¦Ÿà¦¾", "à¦¡à¦¾à¦²", "à¦šà¦¿à¦¨à¦¿", "à¦²à¦¬à¦£", "à¦šà¦¾", "à¦•à¦«à¦¿", "à¦ªà¦¿à¦à¦¯à¦¼à¦¾à¦œ", "à¦†à¦²à§", "à¦Ÿà¦®à§‡à¦Ÿà§‹", "à¦†à¦¦à¦¾", "à¦°à¦¸à§à¦¨", "à¦¤à§‡à¦²", "à¦˜à¦¿", "à¦¸à¦¾à¦¬à¦¾à¦¨", "à¦¶à§à¦¯à¦¾à¦®à§à¦ªà§", "à¦®à¦¾à¦–à¦¨"];

    let groceryData = JSON.parse(localStorage.getItem('proGroceries')) || [];
    let itemHistory = JSON.parse(localStorage.getItem('itemHistory')) || masterItems;
    let currentLang = localStorage.getItem('appLang') || 'en';
    let currentTheme = localStorage.getItem('appTheme') || 'light';

    const translations = {
        en: {
            title: "Grocery List", share: "Share", clear: "Clear", add: "Add",
            ph_item: "Item Name", ph_price: "Price", h_item: "Item Details",
            h_sub: "Price", total: "Total", confirm_clear: "Clear everything?",
            alert_empty: "List is empty!", share_header: "ðŸ›’ *My Grocery List*",
            share_total: "ðŸ’° *Total*", no_unit: "-- No Unit --",
            units: { kg: "kg", g: "g", L: "L", ml: "ml", pcs: "pcs", pkt: "pkt", dz: "doz" }
        },
        bn: {
            title: "à¦¬à¦¾à¦œà¦¾à¦°à§‡à¦° à¦¤à¦¾à¦²à¦¿à¦•à¦¾", share: "à¦¶à§‡à¦¯à¦¼à¦¾à¦°", clear: "à¦®à§à¦›à§à¦¨", add: "à¦¯à§‹à¦—",
            ph_item: "à¦ªà¦£à§à¦¯à§‡à¦° à¦¨à¦¾à¦®", ph_price: "à¦¦à¦¾à¦®", h_item: "à¦ªà¦£à§à¦¯à§‡à¦° à¦¬à¦¿à¦¬à¦°à¦£",
            h_sub: "à¦®à§‚à¦²à§à¦¯", total: "à¦®à§‹à¦Ÿ", confirm_clear: "à¦¸à¦¬ à¦®à§à¦›à§‡ à¦«à§‡à¦²à¦¬à§‡à¦¨?",
            alert_empty: "à¦¤à¦¾à¦²à¦¿à¦•à¦¾ à¦–à¦¾à¦²à¦¿!", share_header: "ðŸ›’ *à¦†à¦®à¦¾à¦° à¦¬à¦¾à¦œà¦¾à¦°à§‡à¦° à¦¤à¦¾à¦²à¦¿à¦•à¦¾*",
            share_total: "ðŸ’° *à¦¸à¦°à§à¦¬à¦®à§‹à¦Ÿ*", no_unit: "-- à¦‡à¦‰à¦¨à¦¿à¦Ÿ à¦›à¦¾à¦¡à¦¼à¦¾ --",
            units: { kg: "à¦•à§‡à¦œà¦¿", g: "à¦—à§à¦°à¦¾à¦®", L: "à¦²à¦¿à¦Ÿà¦¾à¦°", ml: "à¦®à¦¿à¦²à¦¿", pcs: "à¦Ÿà¦¾", pkt: "à¦ªà§à¦¯à¦¾à¦•à§‡à¦Ÿ", dz: "à¦¡à¦œà¦¨" }
        }
    };

    function init() {
        document.body.setAttribute('data-theme', currentTheme);
        document.getElementById('themeToggle').innerText = currentTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
        document.getElementById('langSelect').value = currentLang;
        applyLanguage(currentLang);
        updateHistoryUI();
        renderList();
        if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(()=>{});
    }

    function toggleTheme() {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', currentTheme);
        document.getElementById('themeToggle').innerText = currentTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
        localStorage.setItem('appTheme', currentTheme);
    }

    function applyLanguage(lang) {
        const t = translations[lang];
        document.getElementById('lblTitle').innerText = t.title;
        document.getElementById('btnShare').innerText = t.share;
        document.getElementById('btnClear').innerText = t.clear;
        document.getElementById('btnAdd').innerText = t.add;
        document.getElementById('itemInput').placeholder = t.ph_item;
        document.getElementById('priceInput').placeholder = t.ph_price;
        document.getElementById('lblHeaderItem').innerText = t.h_item;
        document.getElementById('lblHeaderSub').innerText = t.h_sub;
        document.getElementById('lblTotal').innerText = t.total;

        const unitSelect = document.getElementById('unitInput');
        const currentVal = unitSelect.value;
        unitSelect.innerHTML = '';

        // Add blank option first
        let blankOpt = document.createElement('option');
        blankOpt.value = ""; blankOpt.text = t.no_unit;
        unitSelect.appendChild(blankOpt);

        Object.keys(t.units).forEach(key => {
            let opt = document.createElement('option');
            opt.value = key; opt.text = t.units[key];
            unitSelect.appendChild(opt);
        });
        unitSelect.value = currentVal;
    }

    function changeLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('appLang', lang);
        applyLanguage(lang);
        renderList();
    }

    function addItem() {
        const name = document.getElementById('itemInput').value.trim();
        const qty = parseFloat(document.getElementById('qtyInput').value);
        const unit = document.getElementById('unitInput').value;
        const price = parseFloat(document.getElementById('priceInput').value);

        if (name && !isNaN(price) && !isNaN(qty)) {
            groceryData.push({ id: Date.now(), name, qty, unit, price, checked: false });
            if (!itemHistory.includes(name)) {
                itemHistory.unshift(name);
                localStorage.setItem('itemHistory', JSON.stringify(itemHistory));
                updateHistoryUI();
            }
            saveAndRender();
            document.getElementById('itemInput').value = '';
            document.getElementById('priceInput').value = '';
            document.getElementById('itemInput').focus();
        }
    }

    function toggleCheck(id) {
        const item = groceryData.find(i => i.id === id);
        if (item) { item.checked = !item.checked; saveAndRender(); }
    }

    function updateHistoryUI() {
        const dl = document.getElementById('itemHistory');
        dl.innerHTML = '';
        itemHistory.forEach(n => { let o = document.createElement('option'); o.value = n; dl.appendChild(o); });
    }

    function deleteItem(id) {
        groceryData = groceryData.filter(i => i.id !== id);
        saveAndRender();
    }

    function clearAll() {
        if (groceryData.length > 0 && confirm(translations[currentLang].confirm_clear)) {
            groceryData = []; saveAndRender();
        }
    }

    function saveAndRender() {
        localStorage.setItem('proGroceries', JSON.stringify(groceryData));
        renderList();
    }

    function renderList() {
        const list = document.getElementById('itemList');
        const t = translations[currentLang];
        list.innerHTML = '';
        let grandTotal = 0;

        groceryData.forEach(item => {
            const sub = item.qty * item.price;
            grandTotal += sub;
            const uTxt = item.unit === "" ? "" : (t.units[item.unit] || item.unit);
            const row = document.createElement('div');
            row.className = `item-row ${item.checked ? 'is-done' : ''}`;
            row.innerHTML = `
                <div class="check-box ${item.checked ? 'checked' : ''}" onclick="toggleCheck(${item.id})"></div>
                <div class="item-main" onclick="toggleCheck(${item.id})">
                    <span class="item-name">${item.name}</span>
                    <span class="item-details">${item.qty} ${uTxt} Ã— â‚¹${item.price}</span>
                </div>
                <div class="item-subtotal">â‚¹${sub.toLocaleString('en-IN')}</div>
                <span class="delete-btn" onclick="deleteItem(${item.id})">âœ•</span>
            `;
            list.appendChild(row);
        });
        document.getElementById('totalAmount').innerText = `â‚¹${grandTotal.toLocaleString('en-IN')}`;
    }

    function shareList() {
        if (groceryData.length === 0) return alert(translations[currentLang].alert_empty);
        const t = translations[currentLang];
        let msg = `${t.share_header}\n\n`;
        let total = 0;
        groceryData.forEach((item, i) => {
            const sub = item.qty * item.price;
            total += sub;
            const uTxt = item.unit === "" ? "" : t.units[item.unit];
            msg += `${item.checked ? "âœ…" : "â¬œ"} *${item.name}* (${item.qty} ${uTxt})\n   â‚¹${sub}\n`;
        });
        msg += `\n${t.share_total}: â‚¹${total}`;
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    document.addEventListener('keypress', (e) => { if (e.key === 'Enter') addItem(); });
    init();
</script>
</body>
</html>
        
