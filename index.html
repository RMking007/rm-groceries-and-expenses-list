<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grocery Tracker Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1e7e34">
    <style>
        :root {
            --bg: #f0f2f5;
            --card-bg: #ffffff;
            --text-main: #333333;
            --text-sub: #666666;
            --border: #eeeeee;
            --input-bg: #ffffff;
            --primary: #1e7e34;
            --danger: #dc3545;
            --whatsapp: #25D366;
            --shadow: rgba(0,0,0,0.05);
            --history-bg: #fdfdfd;
        }

        [data-theme="dark"] {
            --bg: #121212;
            --card-bg: #1e1e1e;
            --text-main: #e0e0e0;
            --text-sub: #aaaaaa;
            --border: #333333;
            --input-bg: #2d2d2d;
            --shadow: rgba(0,0,0,0.3);
            --history-bg: #252525;
        }

        body { font-family: -apple-system, sans-serif; background-color: var(--bg); color: var(--text-main); display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; transition: 0.3s; }
        .container { background: var(--card-bg); padding: 1.2rem; border-radius: 16px; box-shadow: 0 10px 25px var(--shadow); width: 100%; max-width: 480px; margin-bottom: 20px; }
        
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        select, .theme-btn { padding: 6px; border-radius: 8px; border: 1px solid var(--border); background: var(--input-bg); color: var(--text-main); font-size: 0.85rem; cursor: pointer; }

        /* List Title Bar */
        .list-title-wrapper { margin-bottom: 15px; }
        .list-title-input { border: none; border-bottom: 2px solid var(--border); background: transparent; font-size: 1.2rem; font-weight: 800; color: var(--primary); padding: 5px 0; width: 100%; border-radius: 0; }
        .list-title-input:focus { border-bottom-color: var(--primary); outline: none; }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .action-btns { display: flex; gap: 8px; }
        .btn-small { background: none; border: 1px solid var(--border); padding: 6px 12px; border-radius: 8px; font-size: 0.75rem; cursor: pointer; font-weight: 600; color: var(--text-main); }
        .clear-btn { border-color: var(--danger); color: var(--danger); }
        .share-btn { border-color: var(--whatsapp); color: var(--whatsapp); }

        .input-wrapper { display: flex; flex-direction: column; gap: 10px; margin-bottom: 20px; background: var(--bg); padding: 15px; border-radius: 12px; }
        .row-2 { display: grid; grid-template-columns: 0.8fr 1.2fr 1.2fr auto; gap: 8px; }

        input, select { padding: 10px; border: 1px solid var(--border); border-radius: 8px; font-size: 15px; outline: none; background: var(--input-bg); color: var(--text-main); width: 100%; box-sizing: border-box; }
        
        .add-btn { padding: 10px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        .list-header { display: flex; padding: 10px; font-weight: bold; border-bottom: 2px solid var(--border); color: var(--text-sub); font-size: 0.9rem; }
        .list-header span:first-child { flex: 2; padding-left: 35px; }
        
        .item-row { display: flex; align-items: center; padding: 12px 10px; border-bottom: 1px solid var(--border); }
        .check-box { width: 22px; height: 22px; border: 2px solid var(--primary); border-radius: 6px; margin-right: 12px; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .check-box.checked { background: var(--primary); color: white; }
        .check-box.checked::after { content: '‚úì'; font-weight: bold; font-size: 14px; }

        .item-main { flex: 2; cursor: pointer; }
        .item-name { font-weight: 600; display: block; }
        .item-details { font-size: 0.8rem; color: var(--text-sub); }
        .is-done .item-name { text-decoration: line-through; opacity: 0.6; }
        
        .item-subtotal { text-align: right; font-family: monospace; font-weight: bold; width: 85px; }
        .total-section { display: flex; justify-content: space-between; padding: 20px 10px; margin-top: 10px; border-top: 2px solid var(--text-main); font-size: 1.4rem; font-weight: 800; }
        .delete-btn { color: var(--text-sub); cursor: pointer; padding: 5px; margin-left: 10px; opacity: 0.4; }

        /* History Enhancements */
        .history-container { width: 100%; max-width: 480px; margin-top: 20px; border-top: 1px solid var(--border); padding-top: 20px; }
        .history-title { font-size: 1.1rem; font-weight: 700; margin-bottom: 15px; color: var(--text-sub); display: flex; justify-content: space-between; align-items: center; }
        .history-search { margin-bottom: 15px; }
        .history-card { background: var(--history-bg); border: 1px solid var(--border); border-radius: 12px; padding: 12px; margin-bottom: 10px; }
        .history-card.hidden { display: none; }
        .history-date { font-weight: bold; color: var(--primary); font-size: 0.85rem; display: block; margin-bottom: 2px; }
        .history-list-name { font-size: 0.95rem; font-weight: 700; margin-bottom: 5px; display: block; }
        .history-summary { color: var(--text-sub); font-size: 0.8rem; margin-bottom: 8px; line-height: 1.4; }
        .history-actions { display: flex; justify-content: space-between; align-items: center; border-top: 1px dashed var(--border); padding-top: 8px; }
        .restore-btn { background: var(--primary); color: white; border: none; padding: 4px 10px; border-radius: 6px; font-size: 0.75rem; cursor: pointer; }
        .hist-del-icon { color: var(--danger); cursor: pointer; font-size: 0.9rem; opacity: 0.6; }
        .clear-history-btn { font-size: 0.7rem; color: var(--danger); cursor: pointer; background: none; border: 1px solid var(--danger); padding: 2px 8px; border-radius: 4px; }
    </style>
</head>
<body data-theme="light">

<div class="container">
    <div class="top-bar">
        <select id="langSelect" onchange="changeLanguage(this.value)">
            <option value="en">üá¨üáß English</option>
            <option value="bn">üáßüá© ‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ</option>
        </select>
        <button class="theme-btn" onclick="toggleTheme()" id="themeToggle">üåô</button>
    </div>

    <div class="list-title-wrapper">
        <input type="text" id="listTitle" class="list-title-input" placeholder="List Name">
    </div>

    <div class="header">
        <div class="action-btns">
            <button class="btn-small share-btn" id="btnShare" onclick="shareList()">Share</button>
            <button class="btn-small clear-btn" id="btnClear" onclick="clearAll()">Clear</button>
        </div>
    </div>
    
    <div class="input-wrapper">
        <input type="text" id="itemInput" placeholder="Item Name">
        <div class="row-2">
            <input type="number" id="qtyInput" value="1" min="0.1" step="0.1">
            <select id="unitInput"></select>
            <input type="number" id="priceInput" placeholder="Price">
            <button class="add-btn" id="btnAdd" onclick="addItem()">Add</button>
        </div>
    </div>

    <div class="list-container">
        <div class="list-header">
            <span id="lblHeaderItem">Item</span>
            <span id="lblHeaderSub">Final Price</span>
        </div>
        <div id="itemList"></div>
        <div class="total-section">
            <span id="lblTotal">Total</span>
            <span id="totalAmount">‚Çπ0</span>
        </div>
    </div>
</div>

<div class="history-container">
    <div class="history-title">
        <span id="lblHistory">History</span>
        <button class="clear-history-btn" onclick="deleteFullHistory()" id="lblClearHistory">Clear All</button>
    </div>
    <div class="history-search">
        <input type="text" id="histSearch" onkeyup="searchHistory()" placeholder="Search items or names...">
    </div>
    <div id="historyList"></div>
</div>

<script>
    let groceryData = JSON.parse(localStorage.getItem('proGroceries')) || [];
    let archivedLists = JSON.parse(localStorage.getItem('archivedLists')) || [];
    let currentLang = localStorage.getItem('appLang') || 'en';
    let currentTheme = localStorage.getItem('appTheme') || 'light';

    const translations = {
        en: {
            default_name: "Grocery Trip", share: "Share", clear: "Clear", add: "Add",
            ph_item: "Item Name", ph_price: "Price", h_item: "Item Details",
            h_sub: "Price Paid", total: "Total", confirm_clear: "Save current list to history and clear?",
            alert_empty: "List is empty!", history: "History Log", clear_hist: "Clear All",
            restore: "Restore List", search_ph: "Search items or list names...",
            units: { kg: "kg", g: "g", L: "L", ml: "ml", pcs: "pcs", pkt: "pkt", dz: "doz" },
            no_unit: "--"
        },
        bn: {
            default_name: "‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ", share: "‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞", clear: "‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®", add: "‡¶Ø‡ßã‡¶ó",
            ph_item: "‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ", ph_price: "‡¶¶‡¶æ‡¶Æ", h_item: "‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£",
            h_sub: "‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø", total: "‡¶Æ‡ßã‡¶ü", confirm_clear: "‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡¶ü‡¶ø ‡¶á‡¶§‡¶ø‡¶π‡¶æ‡¶∏‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßá ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®?",
            alert_empty: "‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶ñ‡¶æ‡¶≤‡¶ø!", history: "‡¶™‡ßÅ‡¶∞‡¶æ‡¶®‡ßã ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ", clear_hist: "‡¶∏‡¶¨ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®",
            restore: "‡¶™‡ßÅ‡¶®‡¶∞‡¶æ‡¶Ø‡¶º ‡¶Ü‡¶®‡ßÅ‡¶®", search_ph: "‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶¨‡¶æ ‡¶®‡¶æ‡¶Æ ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßÅ‡¶®...",
            units: { kg: "‡¶ï‡ßá‡¶ú‡¶ø", g: "‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ", L: "‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞", ml: "‡¶Æ‡¶ø‡¶≤‡¶ø", pcs: "‡¶ü‡¶æ", pkt: "‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü", dz: "‡¶°‡¶ú‡¶®" },
            no_unit: "--"
        }
    };

    function init() {
        document.body.setAttribute('data-theme', currentTheme);
        document.getElementById('themeToggle').innerText = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        document.getElementById('langSelect').value = currentLang;
        
        // Set Default List Title with Date
        if(!document.getElementById('listTitle').value) {
            const dateStr = new Date().toLocaleDateString(currentLang === 'bn' ? 'bn-BD' : 'en-IN', { month: 'short', day: 'numeric' });
            document.getElementById('listTitle').value = `${translations[currentLang].default_name} - ${dateStr}`;
        }

        applyLanguage(currentLang);
        renderList();
        renderArchivedHistory();
    }

    function applyLanguage(lang) {
        const t = translations[lang];
        document.getElementById('btnShare').innerText = t.share;
        document.getElementById('btnClear').innerText = t.clear;
        document.getElementById('btnAdd').innerText = t.add;
        document.getElementById('itemInput').placeholder = t.ph_item;
        document.getElementById('priceInput').placeholder = t.ph_price;
        document.getElementById('lblHeaderItem').innerText = t.h_item;
        document.getElementById('lblHeaderSub').innerText = t.h_sub;
        document.getElementById('lblTotal').innerText = t.total;
        document.getElementById('lblHistory').innerText = t.history;
        document.getElementById('lblClearHistory').innerText = t.clear_hist;
        document.getElementById('histSearch').placeholder = t.search_ph;

        const unitSelect = document.getElementById('unitInput');
        unitSelect.innerHTML = `<option value="">${t.no_unit}</option>`;
        Object.keys(t.units).forEach(key => {
            unitSelect.innerHTML += `<option value="${key}">${t.units[key]}</option>`;
        });
    }

    function addItem() {
        const name = document.getElementById('itemInput').value.trim();
        const qty = parseFloat(document.getElementById('qtyInput').value);
        const unit = document.getElementById('unitInput').value;
        const price = parseFloat(document.getElementById('priceInput').value);

        if (name && !isNaN(price)) {
            groceryData.push({ id: Date.now(), name, qty, unit, price, checked: false });
            saveAndRender();
            document.getElementById('itemInput').value = '';
            document.getElementById('priceInput').value = '';
            document.getElementById('itemInput').focus();
        }
    }

    function clearAll() {
        if (groceryData.length === 0) return;
        if (confirm(translations[currentLang].confirm_clear)) {
            const listName = document.getElementById('listTitle').value;
            const archiveEntry = {
                id: Date.now(),
                name: listName,
                date: new Date().toLocaleString(currentLang === 'bn' ? 'bn-BD' : 'en-IN', { dateStyle: 'medium', timeStyle: 'short' }),
                items: [...groceryData],
                total: groceryData.reduce((sum, i) => sum + i.price, 0)
            };
            archivedLists.unshift(archiveEntry);
            localStorage.setItem('archivedLists', JSON.stringify(archivedLists));
            groceryData = [];
            
            // Refresh title for next time
            const dateStr = new Date().toLocaleDateString(currentLang === 'bn' ? 'bn-BD' : 'en-IN', { month: 'short', day: 'numeric' });
            document.getElementById('listTitle').value = `${translations[currentLang].default_name} - ${dateStr}`;
            
            saveAndRender();
            renderArchivedHistory();
        }
    }

    function searchHistory() {
        const query = document.getElementById('histSearch').value.toLowerCase();
        const cards = document.querySelectorAll('.history-card');
        cards.forEach(card => {
            const text = card.innerText.toLowerCase();
            card.classList.toggle('hidden', !text.includes(query));
        });
    }

    function renderArchivedHistory() {
        const container = document.getElementById('historyList');
        const t = translations[currentLang];
        container.innerHTML = '';
        archivedLists.forEach(list => {
            const div = document.createElement('div');
            div.className = 'history-card';
            const itemNames = list.items.map(i => i.name).join(', ');
            div.innerHTML = `
                <span class="history-date">${list.date}</span>
                <span class="history-list-name">${list.name || t.default_name}</span>
                <div class="history-summary">${itemNames}</div>
                <div class="history-actions">
                    <span style="font-weight:bold">‚Çπ${list.total}</span>
                    <div>
                        <button class="restore-btn" onclick="restoreList(${list.id})">${t.restore}</button>
                        <span class="hist-del-icon" onclick="deleteHistoryItem(${list.id})" style="margin-left:10px">‚úï</span>
                    </div>
                </div>
            `;
            container.appendChild(div);
        });
    }

    function renderList() {
        const list = document.getElementById('itemList');
        const t = translations[currentLang];
        list.innerHTML = '';
        let grandTotal = 0;
        groceryData.forEach(item => {
            grandTotal += item.price; 
            const uTxt = item.unit === "" ? "" : (t.units[item.unit] || item.unit);
            const row = document.createElement('div');
            row.className = `item-row ${item.checked ? 'is-done' : ''}`;
            row.innerHTML = `
                <div class="check-box ${item.checked ? 'checked' : ''}" onclick="toggleCheck(${item.id})"></div>
                <div class="item-main" onclick="toggleCheck(${item.id})">
                    <span class="item-name">${item.name}</span>
                    <span class="item-details">${item.qty} ${uTxt}</span>
                </div>
                <div class="item-subtotal">‚Çπ${item.price}</div>
                <span class="delete-btn" onclick="deleteItem(${item.id})">‚úï</span>
            `;
            list.appendChild(row);
        });
        document.getElementById('totalAmount').innerText = `‚Çπ${grandTotal}`;
    }

    // Helper Functions
    function toggleTheme() {
        currentTheme = currentTheme === 'light' ? 'dark' : 'light';
        document.body.setAttribute('data-theme', currentTheme);
        document.getElementById('themeToggle').innerText = currentTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        localStorage.setItem('appTheme', currentTheme);
    }
    function changeLanguage(lang) {
        currentLang = lang;
        localStorage.setItem('appLang', lang);
        init();
    }
    function toggleCheck(id) {
        const item = groceryData.find(i => i.id === id);
        if (item) { item.checked = !item.checked; saveAndRender(); }
    }
    function deleteItem(id) {
        groceryData = groceryData.filter(i => i.id !== id);
        saveAndRender();
    }
    function saveAndRender() {
        localStorage.setItem('proGroceries', JSON.stringify(groceryData));
        renderList();
    }
    function restoreList(archiveId) {
        const archived = archivedLists.find(l => l.id === archiveId);
        if (archived) {
            const restoredItems = archived.items.map(item => ({ ...item, id: Date.now() + Math.random(), checked: false }));
            groceryData = [...groceryData, ...restoredItems];
            saveAndRender();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    }
    function deleteHistoryItem(archiveId) {
        archivedLists = archivedLists.filter(l => l.id !== archiveId);
        localStorage.setItem('archivedLists', JSON.stringify(archivedLists));
        renderArchivedHistory();
    }
    function deleteFullHistory() {
        if (confirm("Delete all history entries permanently?")) {
            archivedLists = [];
            localStorage.setItem('archivedLists', JSON.stringify(archivedLists));
            renderArchivedHistory();
        }
    }
    function shareList() {
        if (groceryData.length === 0) return alert(translations[currentLang].alert_empty);
        const t = translations[currentLang];
        const title = document.getElementById('listTitle').value;
        let msg = `üõí *${title}*\n\n`;
        let total = 0;
        groceryData.forEach((item) => {
            total += item.price;
            const uTxt = item.unit === "" ? "" : t.units[item.unit];
            msg += `${item.checked ? "‚úÖ" : "‚¨ú"} *${item.name}* (${item.qty} ${uTxt}) - ‚Çπ${item.price}\n`;
        });
        msg += `\n*Total: ‚Çπ${total}*`;
        window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
    }

    document.addEventListener('keypress', (e) => { if (e.key === 'Enter') addItem(); });
    init();
</script>
</body>
    </html>
    
